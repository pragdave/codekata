
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Kata09: Back to the Checkout - CodeKata</title>
  <meta name="author" content="Dave Thomas (@PragDave)">

  
  <meta name="description" content="Back to the supermarket. This week, we’ll implement the code for a
checkout system that handles pricing schemes such as “apples cost 50
cents, three &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pragdave.github.io/codekata/kata/kata09-back-to-the-checkout">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="CodeKata" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<link href='http://fonts.googleapis.com/css?family=Merienda:400' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
>

  

</head>

<body   >
  <header role="banner"><aside id="kitten"></aside>
<hgroup>
  <h1><a href="/">CodeKata</a></h1>
  
    <h2>Because experience<br/>is the <em>only</em> teacher</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pragdave.github.io/codekata" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="http://pragdave.me/">PragDave</a></li>
  <li><a href="/">Kata</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Kata09: Back to the Checkout</h1>
    
  </header>


<div class="entry-content"><p>Back to the supermarket. This week, we’ll implement the code for a
checkout system that handles pricing schemes such as “apples cost 50
cents, three apples cost $1.30.”</p>

<!-- more -->


<p>Way back in KataOne we thought about how to model the various options
for supermarket pricing. We looked at things such as “three for a
dollar,” “$1.99 per pound,” and “buy two, get one free.”</p>

<p>This week, let’s implement the code for a supermarket checkout that
calculates the total price of a number of items. In a normal
supermarket, things are identified using Stock Keeping Units, or
SKUs. In our store, we’ll use individual letters of the alphabet (A,
B, C, and so on). Our goods are priced individually. In addition, some
items are multipriced: buy n of them, and they’ll cost you y
cents. For example, item ‘A’ might cost 50 cents individually, but
this week we have a special offer: buy three ‘A’s and they’ll cost you
$1.30. In fact this week’s prices are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  Item   Unit      Special
</span><span class='line'>         Price     Price
</span><span class='line'>  --------------------------
</span><span class='line'>    A     50       3 for 130
</span><span class='line'>    B     30       2 for 45
</span><span class='line'>    C     20
</span><span class='line'>    D     15</span></code></pre></td></tr></table></div></figure>


<p>Our checkout accepts items in any order, so that if we scan a B, an A,
and another B, we’ll recognize the two B’s and price them at 45 (for a
total price so far of 95). Because the pricing changes frequently, we
need to be able to pass in a set of pricing rules each time we start
handling a checkout transaction.</p>

<p>The interface to the checkout should look like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">co</span> <span class="o">=</span> <span class="no">CheckOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">pricing_rules</span><span class="p">)</span>
</span><span class='line'><span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'><span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span class='line'>    <span class="p">:</span>    <span class="p">:</span>
</span><span class='line'><span class="n">price</span> <span class="o">=</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here’s a set of unit tests for a Ruby implementation. The helper
method price lets you specify a sequence of items using a string,
calling the checkout’s scan method on each item in turn before finally
returning the total price.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">TestPrice</span> <span class="o">&lt;</span> <span class="ss">Test</span><span class="p">:</span><span class="ss">:Unit</span><span class="o">::</span><span class="no">TestCase</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">price</span><span class="p">(</span><span class="n">goods</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span> <span class="o">=</span> <span class="no">CheckOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">RULES</span><span class="p">)</span>
</span><span class='line'>    <span class="n">goods</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">//</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">total</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_totals</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span> <span class="mi">50</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span> <span class="mi">80</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AB&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;CDBA&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AA&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAA&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAAA&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAAAA&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">260</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAAAAA&quot;</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAAB&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">175</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAABB&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;AAABBD&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span> <span class="n">price</span><span class="p">(</span><span class="s2">&quot;DABABA&quot;</span><span class="p">))</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">test_incremental</span>
</span><span class='line'>    <span class="n">co</span> <span class="o">=</span> <span class="no">CheckOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">RULES</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert_equal</span><span class="p">(</span>  <span class="mi">0</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">);</span>  <span class="n">assert_equal</span><span class="p">(</span> <span class="mi">50</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">);</span>  <span class="n">assert_equal</span><span class="p">(</span> <span class="mi">80</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">);</span>  <span class="n">assert_equal</span><span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">);</span>  <span class="n">assert_equal</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>    <span class="n">co</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">);</span>  <span class="n">assert_equal</span><span class="p">(</span><span class="mi">175</span><span class="p">,</span> <span class="n">co</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are lots of ways of implementing this kind of algorithm; if you
have time, experiment with several.</p>

<h1>Objectives of the Kata</h1>

<p>To some extent, this is just a fun little problem. But underneath the
covers, it’s a stealth exercise in decoupling. The challenge
description doesn’t mention the format of the pricing rules. How can
these be specified in such a way that the checkout doesn’t know about
particular items and their pricing strategies? How can we make the
design flexible enough so that we can add new styles of pricing rule
in the future?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Dave Thomas (@PragDave)</span></span>

      








  


<time datetime="2013-12-21T18:08:19-06:00" pubdate data-updated="true">Dec 21<span>st</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://pragdave.github.io/codekata/kata/kata09-back-to-the-checkout/" data-via="" data-counturl="http://pragdave.github.io/codekata/kata/kata09-back-to-the-checkout/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/kata/kata10-hashes-vs-classes/" title="Previous Post: Kata10: Hashes vs. Classes">&laquo; Kata10: Hashes vs. Classes</a>
      
      
        <a class="basic-alignment right" href="/kata/kata08-conflicting-objectives/" title="Next Post: Kata08: Conflicting Objectives">Kata08: Conflicting Objectives &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/kata/codekata-how-it-started/">CodeKata: How It Started</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata-kumite-koan-and-dreyfus/">Kata, Kumite, Koan, and Dreyfus</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata01-supermarket-pricing/">Kata01: Supermarket Pricing</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata02-karate-chop/">Kata02: Karate Chop</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata03-how-big-how-fast/">Kata03: How Big? How Fast?</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata04-data-munging/">Kata04: Data Munging</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata05-bloom-filters/">Kata05: Bloom Filters</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata06-anagrams/">Kata06: Anagrams</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata07-howd-i-do/">Kata07: How'd I Do?</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata08-conflicting-objectives/">Kata08: Conflicting Objectives</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata09-back-to-the-checkout/">Kata09: Back to the Checkout</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata10-hashes-vs-classes/">Kata10: Hashes vs. Classes</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata11-sorting-it-out/">Kata11: Sorting It Out</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata12-best-sellers/">Kata12: Best Sellers</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata13-counting-code-lines/">Kata13: Counting Code Lines</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata14-tom-swift-under-the-milkwood/">Kata14: Tom Swift Under the Milkwood</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata15-a-diversion/">Kata15: A Diversion</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata16-business-rules/">Kata16: Business Rules</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata17-more-business-rules/">Kata17: More Business Rules</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata18-transitive-dependencies/">Kata18: Transitive Dependencies</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata19-word-chains/">Kata19: Word Chains</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata20-klondike/">Kata20: Klondike</a>
      </li>
    
      <li class="post">
        <a href="/kata/kata21-simple-lists/">Kata21: Simple Lists</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Dave Thomas (@PragDave) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'pragdave';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pragdave.github.io/codekata/kata/kata09-back-to-the-checkout/';
        var disqus_url = 'http://pragdave.github.io/codekata/kata/kata09-back-to-the-checkout/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
